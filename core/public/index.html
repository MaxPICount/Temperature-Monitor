<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sensor Reports</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">


    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

    <script>
        function initTables() {
            $('#hourly-report').DataTable();
            $('#malfunctions').DataTable();
        }

        fetchData('/report/hourly', 'hourly-report').then(initTables);
        fetchData('/report/malfunctions', 'malfunctions').then(initTables);
    </script>
</head>
<body class="container mt-4">

<h2>Hourly Temperature Report</h2>
    <div class="btn-group mb-3">
        <button class="btn btn-primary" onclick="showReport('hourly')">Hourly Report</button>
        <button class="btn btn-secondary" onclick="showReport('malfunctions')">Malfunctions</button>
    </div>

    <div id="report-hourly" class="report">
        <h3>Hourly Temperature Report</h3>
<table class="table table-striped">
    <thead>
    <tr>
        <th>Face</th>
        <th>Avg Temperature</th>
    </tr>
    </thead>
    <tbody id="hourly-report"></tbody>
</table>
    </div>

    <div id="report-malfunctions" class="report" style="display: none;">
        <h3>Malfunctioning Sensors</h3>
<table class="table table-striped">
    <thead>
    <tr>
        <th>Sensor ID</th>
        <th>Face</th>
        <th>Avg Temp</th>
        <th>Deviation (%)</th>
    </tr>
    </thead>
    <tbody id="malfunctions"></tbody>
</table>
    </div>

<script>
    async function fetchData(url, elementId) {
        const response = await fetch(url);
        const data = await response.json();
        const tableBody = document.getElementById(elementId);
        tableBody.innerHTML = data.map(row =>
            `<tr>${Object.values(row).map(value => `<td>${value}</td>`).join('')}</tr>`
        ).join('');
    }

        function showReport(report) {
            document.querySelectorAll('.report').forEach(el => el.style.display = 'none');
            document.getElementById('report-' + report).style.display = 'block';
        }

    fetchData('/report/hourly', 'hourly-report');
    fetchData('/report/malfunctions', 'malfunctions');
</script>

</body>
</html>
